#!/usr/bin/python
import sys
if len(sys.argv) != 2:
   print("Please, specify host as the first parameter.")
   sys.exit()
import os
import re
import socket
is_ip = re.compile(r'[0-9\.]{11,14}$')
if is_ip.match(sys.argv[1]) is None:
   domain_name = sys.argv[1]
   ip_addresses = socket.gethostbyname_ex(sys.argv[1])[2]
else:
   ip_addreses = list(sys.argv[1])
   domain_name = socket.gethostbyaddr(sys.argv[1])[0]
#for ip_adsress in ip addresses: 
"""nmap_result = os.popen("nmap -sV "+ip_address+" -p 1-65535 | awk '{print $1,$3,$4,$5,$6,$7,$8}'").readlines()
nmap_dict = {}
for line in nmap_result:
    if 'unrecognized' in line:
        break
    if 'unknown' in line:
        continue
    space_number = line.find(' ')
    nmap_dict[line[:space_number]] = line[space_number:]
print(nmap_dict)
if nmap_dict.get('25/tcp'):"""
answer = raw_input("It seems that this host has email service, do you have login and password? (y/n):\n")
if answer == 'y':
        login = raw_input("Please, input login for email service:\n")
        password = raw_input("Please, input password for email service:\n")
        import smtplib
        import string
        import random
        sender = login+"@"+domain_name
        print(sender)
        smtp_login = sender
        smtp_password = password
        print(password)
        recipient = ''.join(random.choice(string.ascii_uppercase + string.digits) for _ in range(10))+"@"+domain_name
        smtp_server = "92.63.71.187"
        smtp_port = 25
        subject = "Hello mail"
        msg = ("From: %s\r\nTo: %s\r\nSubject: %s\n"% (sender, ", ".join(recipient), subject))
        msg += "Content-type: text/html\n\n"
        server = smtplib.SMTP(smtp_server, smtp_port)
        server.ehlo()
        server.starttls()
        server.login(smtp_login, smtp_password)
        server.sendmail(sender, recipient, msg)
        server.quit()
